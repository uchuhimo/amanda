- src: "amanda/pytorch"
  dst: "debugging"
  rules:
    - ops:
        - output_ports:
            - tensor:
                attrs:
                  src:
                    - key: "type"
                      ref: "tensor_type"
                  dst:
                    - ref: "tensor_type"
                    - key: "is_valid"
                      value: "{tensor_type.value.kind() == 'TensorType'}"
- src: "debugging"
  dst: "amanda/pytorch"
  rules:
    - ops:
        - type: "store_tensor_to_file"
          output_ports:
            src:
              - index: 0
                ref: "output_port"
            dst:
              - ref: "output_port"
                tensor:
                  attrs:
                    - key: "type"
                      value: "{op.input_tensors[0].attrs['type']}"

    - ops:
        - type:
            src: "store_tensor_to_file"
            dst: "amanda::store_tensor_to_file"
- src: "amanda/tensorflow"
  dst: "debugging"
  rules:
    - ops:
        - output_ports:
            - tensor:
                attrs:
                  src:
                    - key: "dtype"
                      ref: "dtype"
                  dst:
                    - ref: "dtype"
                    - key: "is_valid"
                      value: "{dtype.value._is_ref_dtype}"
- src: "debugging"
  dst: "amanda/tensorflow"
  rules:
    - ops:
        src:
          - type: "store_tensor_to_file"
            ref: "debug_op"
        dst:
          - ref: "debug_op"
            name: "{op.input_ops[0].name + op.output_ops[0].name}"
            attrs:
              - key: "T"
                value: "{op.input_tensors[0].attrs['dtype']}"
    - ops:
        - type:
            src: "store_tensor_to_file"
            dst: "StoreTensorToFile"
